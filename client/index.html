<body>
  <label for="restUrl">Rest URL: <input type="text" id="restUrl" value="http://localhost:4001" /></label>
  <label for "websocketUrl">Websocket Url: <input type="text" id="websocketUrl"
      value="ws://localhost:4003" /></label><br>
  <hr>
  <button disabled id="getTags1" class="rfid ws">getTags via Websocket</button> vs.
  <button disabled id="getTags2" class="rfid">getTags via REST</button><br>

  <button disabled id="rfOff1" class="rfid ws">rfOff via Websocket</button> vs.
  <button disabled id="rfOff2" class="rfid">rfOff via REST</button><br>

  Tags:<br> <textarea id="output" cols="80" rows="10"></textarea><br>
  ISO 28560-3: <br><textarea id="iso" cols="80" rows="20"></textarea>
</body>

<script type="module">
  import { getTags, rfOff } from './rest.js';
  import ISO28560 from './libs/iso28560-3/lib/ISO28560.js';
  import { initWebsocket, getTagsWS, rfOffWS } from './websocket.js';

  
  var rfidSelectedReader = "mr102@home";

  let websocketServer = document.getElementById('websocketUrl').value;
  initWebsocket(websocketServer,processTag);
  /*document.getElementById('websocketUrl').addEventListener('change', (ev) => {
    console.log("change", ev.target.value);
    websocketServer = ev.target.value;
  })*/
  

  // rest buttons
  document.getElementById('getTags2').addEventListener('click', async () => {
    emptyOutput();
    getTags(rfidSelectedReader).then(response => {
      for (let tag of response.tags) {
        processTag(tag);
      }
    }).catch(error => {
      console.log(error)
    })
  });

  document.getElementById('rfOff2').addEventListener('click', () => { rfOff(rfidSelectedReader) });


  // websocket buttons
  document.getElementById('getTags1').addEventListener('click', async () => {
    emptyOutput();
    let response = await getTagsWS(rfidSelectedReader);
  })
  document.getElementById('rfOff1').addEventListener('click', async () => {
    let response = await rfOffWS(rfidSelectedReader);
  })


  function emptyOutput() {
    document.querySelector('#iso').innerHTML = "";
    document.querySelector('#output').innerHTML = "";
  }

  // on tag
  function processTag(tag) {

    document.querySelector('#output').innerHTML += JSON.stringify(tag)
    let model = new ISO28560(tag.data);
    document.querySelector('#iso').innerHTML += JSON.stringify(model, null, 2)

  }

</script>